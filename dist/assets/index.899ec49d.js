import{a as I,r as S,az as D,f as l,aA as X,j as e,aB as ee,aC as re,a0 as j,aD as ne,G as k,aE as le,Q as Z,S as w,T as de,V as $,aF as ce,X as b,Y as d,L as te,aG as ae,aH as oe,aI as se}from"./index.6f97c64f.js";import{S as ie}from"./react-select.esm.eab0f134.js";import{a as P}from"./App.571d4ccd.js";import{h as he}from"./moment.4d75c86c.js";import"./emotion-memoize.esm.06f0e458.js";const pe=({isOpen:r,toggle:u,data:h})=>{const o=P(),{rejectOptions:t}=I(n=>n.batchList),[i,c]=S.exports.useState(null),s=(n,p)=>{c({...i,[n]:p})},a=n=>{s(n.target.name,n.target.value)},_=async()=>{const n=o(le(i));(n==null?void 0:n.payload)==201&&(setRejectShow(!rejectShow),getBatchData())};return S.exports.useEffect(()=>{o(D()),c({id:h==null?void 0:h.id,item_id:h==null?void 0:h.item_id,origin:"BD",title:"Batch view"})},[h]),l(X,{isOpen:r,toggle:u,className:"modal-lg",children:[e(ee,{toggle:u,children:"Reject Information"}),l(re,{children:[e("h5",{children:"Inventory"}),l("div",{className:"btn-group","data-toggle":"buttons",children:[l("label",{className:"btn btn-default btn-lg",style:{width:"280px"},children:[e("span",{className:"glyphicon glyphicon-trash"}),e(j,{type:"radio",name:"scrap",value:"1",onChange:a})," ","Defective Item Produced"]}),l("label",{className:"btn btn-default btn-lg",style:{width:"280px"},children:[e(j,{type:"radio",name:"scrap",value:"0",onChange:a})," ","Nothing Produced"]})]}),e("hr",{}),l("div",{className:"btn-group","data-toggle":"buttons",children:[e("h5",{children:"Graphic"}),l("label",{className:"btn btn-default btn-lg",style:{width:"180px"},children:[e("span",{className:"glyphicon glyphicon-print"}),e(j,{type:"radio",name:"graphic_status",value:"1",onChange:a})," ","Print Again"]}),l("label",{className:"btn btn-default btn-lg",style:{width:"180px"},children:[e("span",{className:"glyphicon glyphicon-pencil"}),e(j,{type:"radio",name:"graphic_status",value:"2",onChange:a})," ","Edit Graphic"]}),l("label",{className:"btn btn-default btn-lg",style:{width:"205px"},children:[e("span",{className:"glyphicon glyphicon-envelope"}),e(j,{type:"radio",name:"graphic_status",value:"4",onChange:a})," ","Contact Customer"]})]}),e("hr",{}),l("div",{className:"form-group",id:"qty_group",children:["Quantity to Reject:"," ",e(j,{type:"number",id:"reject_qty",name:"reject_qty",value:i==null?void 0:i.reject_qty,min:"1",onChange:a})]}),e("div",{className:"form-group",children:e(ie,{className:"select",classNamePrefix:"react-select",name:"rejection_reason",options:t,value:t==null?void 0:t.find(n=>n.value===(i==null?void 0:i.reasonToReject)),onChange:n=>s("rejection_reason",n.value),children:e("option",{value:"",children:"Select a reason to reject"})})}),e("div",{className:"form-group",children:e(j,{type:"textarea",id:"rejection_message",rows:2,className:"form-control",placeholder:"More Information",name:"rejection_message",value:i==null?void 0:i.rejection_message,onChange:a})})]}),l(ne,{children:[e(k,{color:"default",onClick:u,className:"btn-lg modal-close",children:"Close"}),e(k,{color:"danger",onClick:_,className:"btn-lg",children:"Reject"})]})]})},ue=({show:r,handleClose:u,handleUpload:h,uploadData:o,FileUpload:t})=>e(X,{isOpen:r,toggle:u,className:"modal-lg",children:l(Z,{children:[e(w,{closeButton:!0,children:e(de,{children:"Upload a Graphic"})}),l($,{children:[e("p",{children:"Upload a graphic to the Archive directory."}),e(j,{type:"file",className:"form-control",onChange:s=>{s.preventDefault();const a=new FileReader,_=s.target.files[0];a.onloadend=()=>{h({...o,upload_file:_})},a.readAsDataURL(_)}})]}),l(ce,{children:[e(k,{className:"success",onClick:async s=>{s.preventDefault(),o!=null&&o.upload_file?(await t(o),u()):alert("Please select a file to upload")},children:"Upload"}),e(k,{className:"secondary mx-1",onClick:u,children:"Close"})]})]})}),be=()=>{var u,h,o,t,i,c,s,a,_,n,p,N,v,y,C,x,f,m,R,g,B,U,F,E,M,T,A,G,O,q,Y,Q,z,H,V,J,K,W;const{showData:r}=I(L=>L.batchList);return l($,{children:[l(b,{className:"p-1 pt-0",children:[l(d,{md:"1",children:[e("b",{children:"**Route:"})," "]}),e(d,{md:"9",children:((u=r==null?void 0:r.batch)==null?void 0:u.route)&&e("span",{children:l("span",{children:[(o=(h=r==null?void 0:r.batch)==null?void 0:h.route)==null?void 0:o.batch_code,"/",(i=(t=r==null?void 0:r.batch)==null?void 0:t.route)==null?void 0:i.batch_route_name," => ",r==null?void 0:r.stations]})})}),e(d,{md:"2",children:(s=(c=r==null?void 0:r.batch)==null?void 0:c.route)!=null&&s.template?l("span",{children:[(n=(_=(a=r==null?void 0:r.batch)==null?void 0:a.route)==null?void 0:_.template)==null?void 0:n.template_name," Template"]}):e("span",{children:"No Template"})})]}),l(b,{className:"p-1 pt-0",children:[e(d,{md:"1",children:e("b",{children:"Created:"})}),e(d,{md:"3",children:(p=r==null?void 0:r.batch)==null?void 0:p.creation_date}),e(d,{md:"1",children:e("b",{children:"Last Scan:"})}),e(d,{md:"3",children:(N=r==null?void 0:r.last_scan)!=null&&N.date?((v=r==null?void 0:r.last_scan)==null?void 0:v.date)+" by "+((y=r==null?void 0:r.last_scan)==null?void 0:y.username):(C=r==null?void 0:r.batch)==null?void 0:C.change_date}),e(d,{md:"1",children:e("b",{children:"Station:"})}),e(d,{md:"3",children:(x=r==null?void 0:r.batch)!=null&&x.station?((m=(f=r==null?void 0:r.batch)==null?void 0:f.station)==null?void 0:m.station_name)+" => "+((g=(R=r==null?void 0:r.batch)==null?void 0:R.station)==null?void 0:g.station_description):"Station Not Found"})]}),l(b,{className:"p-1 pt-0",children:[e(d,{md:"1",children:e("b",{children:"Export:"})}),e(d,{md:"3",children:(B=r==null?void 0:r.batch)!=null&&B.export_date?((U=r==null?void 0:r.batch)==null?void 0:U.export_count)==1?l("span",{children:["Exported ",(F=r==null?void 0:r.batch)==null?void 0:F.export_count," time"," ",(E=r==null?void 0:r.batch)==null?void 0:E.export_date]}):l("span",{children:["Exported ",(M=r==null?void 0:r.batch)==null?void 0:M.export_count," times Last export"," ",(T=r==null?void 0:r.batch)==null?void 0:T.export_date]}):"Not Exported"}),e(d,{md:"4",children:((A=r==null?void 0:r.batch)==null?void 0:A.csv_found)!=0&&"CSV File Found"})]}),l(b,{className:"p-1 pt-0",children:[e(d,{md:"1",children:e("b",{children:"Summary:"})}),(G=r==null?void 0:r.batch)!=null&&G.summary_date?e(d,{md:"6",children:l(b,{children:[l(d,{md:"6",children:["Printed ",(O=r==null?void 0:r.batch)==null?void 0:O.summary_date]}),l(d,{md:"6",children:[(q=r==null?void 0:r.batch)==null?void 0:q.summary_count," printed - last by"," ",(Q=(Y=r==null?void 0:r.batch)==null?void 0:Y.summary_user)==null?void 0:Q.username]})]})}):e(d,{md:"6",children:"Not Printed"})]}),l(b,{className:"p-1 pt-0",children:[e(d,{md:"1",children:e("b",{children:"Graphic:"})}),e(d,{md:"3",children:(z=r==null?void 0:r.batch)==null?void 0:z.graphic_found}),((H=r==null?void 0:r.batch)==null?void 0:H.to_printer)!="0"&&e(d,{md:"4",children:l(b,{children:[e(d,{md:"3",children:e("b",{children:"Printed:"})}),l(d,{md:"9",children:[(V=r==null?void 0:r.batch)==null?void 0:V.to_printer," -"," ",(J=r==null?void 0:r.batch)==null?void 0:J.to_printer_date]})]})})]}),((K=r==null?void 0:r.related)==null?void 0:K.length)>0&&l(b,{className:"p-1 pt-0",children:[e(d,{md:"1",children:e("b",{children:"Related:"})}),e(d,{md:"3",children:(W=r==null?void 0:r.related)==null?void 0:W.map(L=>l("span",{children:[L," "]}))})]})]})},me=({batchNote:r,setBatchNote:u,onClick:h})=>{var t,i;const{showData:o}=I(c=>c.batchList);return l($,{children:[l(b,{children:[e(d,{md:"2",className:"p-1 border",children:e("b",{children:"Note"})}),e(d,{md:"1",className:"p-1 border",children:e("b",{children:"Date"})}),e(d,{md:"2",className:"p-1 border",children:e("b",{children:"User"})}),e(d,{md:"1",className:"p-1 border",children:e("b",{children:"Station"})}),e(d,{md:"2",className:"p-1 border",children:e("b",{children:"Station"})}),e(d,{md:"2",className:"p-1 border",children:e("b",{children:"Scan In"})}),e(d,{md:"2",className:"p-1 border",children:e("b",{children:"Scan Out"})})]}),l(b,{children:[e(d,{md:"6",children:(t=o==null?void 0:o.notes)==null?void 0:t.map(c=>{var s,a;return e("span",{children:l(b,{className:"p-1",children:[e(d,{md:"4",children:c==null?void 0:c.note}),e(d,{md:"2",children:he(c==null?void 0:c.created_at).format("DD MM YYYY")}),e(d,{md:"4",children:(s=c==null?void 0:c.user)==null?void 0:s.username}),e(d,{md:"2",children:(a=c==null?void 0:c.station)==null?void 0:a.station_name})]})})})}),e(d,{md:"6",children:(i=o==null?void 0:o.scans)==null?void 0:i.map(c=>{var s,a;return e("span",{children:l(b,{className:"p-1",children:[e(d,{md:"4",children:(s=c==null?void 0:c.station)==null?void 0:s.station_name}),l(d,{md:"4",children:[(a=c==null?void 0:c.in_user)==null?void 0:a.username," ",c==null?void 0:c.in_date]}),e(d,{md:"4",children:(c==null?void 0:c.out_user)&&c.out_user.username+" "+c.out_date})]})})})})]}),l(b,{children:[e(d,{md:"4",children:e(j,{type:"textarea",name:"note",id:"note",placeholder:"Enter Note",value:r,onChange:c=>{u(c.target.value)}})}),e(d,{md:"2",children:e(k,{color:"primary",onClick:h,children:"Add Note"})})]})]})},_e=({handleClose:r,setRejectData:u,handleRejectClose:h,setUploadData:o})=>{var a,_;P();const{showData:t}=I(n=>n.batchList),i=(n,p)=>{n.preventDefault(),o({item_id:p==null?void 0:p.id,batch_number:p==null?void 0:p.batch_number}),r()},c=n=>{u(n),h()},s=(n,p=`
`,N=0)=>{let v="",y="";N===1&&(v='<strong style="font-size: 110%;">',y="</strong>");let C="";const x=JSON.parse(n);if(x)for(const f in x){let m=x[f];f!=="Confirmation_of_Order_Details"&&f!=="couponcode"&&((m==null?void 0:m.includes("$"))&&N===1&&(m=`<span style="font-size: 120%;">${m}</span>`),C+=`${f.replaceAll("_"," ")} = ${v}${m}${y}${p}`),console.log(C)}return C};return l($,{children:[l(b,{children:[e(d,{md:"1",className:"p-1 border"}),e(d,{md:"3",className:"p-1 border",children:e("b",{children:"Order"})}),e(d,{md:"2",className:"p-1 border"}),e(d,{md:"3",className:"p-1 border",children:e("b",{children:"Product"})}),e(d,{md:"3",className:"p-1 border",children:e("b",{children:"Options"})})]}),(_=(a=t==null?void 0:t.batch)==null?void 0:a.items)==null?void 0:_.map(n=>{var p,N,v,y,C,x,f,m,R;return l("span",{children:[l(b,{className:"p-1 border",children:[e(d,{md:"1",children:(n==null?void 0:n.item_status)==="production"||(n==null?void 0:n.item_status)==="wap"||(n==null?void 0:n.item_status)==="back order"?l(k,{color:"primary",onClick:()=>c({id:t==null?void 0:t.batch_number,item_id:n==null?void 0:n.id,origin:"BD"}),children:["Reject ",(n==null?void 0:n.item_status)=="wap"?" from Wap":""]}):e("span",{children:n.item_status.charAt(0).toUpperCase()+n.item_status.slice(1)})}),l(d,{md:"3",children:["Order:"," ",e(te,{to:`/customer-order-edit/${(p=n==null?void 0:n.order)==null?void 0:p.id}`,children:(N=n==null?void 0:n.order)==null?void 0:N.short_order}),e("br",{}),"Date : ",(v=n==null?void 0:n.order)==null?void 0:v.order_date,e("br",{}),"Store: ",(C=(y=n==null?void 0:n.order)==null?void 0:y.store)==null?void 0:C.store_name,e("br",{}),"Re Download Graphic: ",n==null?void 0:n.id,e("br",{}),((f=(x=t==null?void 0:t.batch)==null?void 0:x.station)==null?void 0:f.type)=="Q"&&l(k,{color:"primary",onClick:g=>i(g,n),children:["Upload ",n==null?void 0:n.id," Graphic"]})]}),e(d,{md:"2"}),l(d,{md:"3",children:[n==null?void 0:n.child_sku,e("br",{}),n==null?void 0:n.item_description,e("br",{}),"Item# ",n==null?void 0:n.id,e("br",{}),(n==null?void 0:n.item_quantity)===1?l("span",{children:["QTY: ",n==null?void 0:n.item_quantity]}):l("strong",{children:["QTY: ",n==null?void 0:n.item_quantity]}),e("br",{}),n.spec_sheet&&l("div",{children:[e("a",{href:`/products_specifications/${n.spec_sheet.id}`,target:"_blank",children:"Production Instruction"}),e("br",{})]}),n.supervisor_message&&l("div",{children:[n.supervisor_message,e("br",{})]}),n.tracking_number&&l("div",{style:{color:"red"},children:["TRK# ",n.tracking_number]})]}),e(d,{md:"3",children:e(j,{type:"textarea",Rows:"5",value:s(n==null?void 0:n.item_option),disabled:!0})})]}),((m=n==null?void 0:n.rejections)==null?void 0:m.length)&&((R=n==null?void 0:n.rejections)==null?void 0:R.map(g=>l(b,{className:"p-1 border",children:[e(d,{md:2}),l(d,{md:8,children:["Item ",n.id," Rejected ",g.created_at," by"," ",g.user.username,g.rejection_reason_info&&` - ${g.rejection_reason_info.rejection_message}`,"- ",g.rejection_message]})]})))]})})]})},xe=()=>{var R,g,B;const{id:r}=ae(),[u,h]=S.exports.useState(null),o=P(),{showData:t}=I(U=>U.batchList),[i,c]=S.exports.useState(!1),s=async()=>{c(!0),r&&await o(oe({id:r,batchNote:u})),h(""),c(!1)};S.exports.useEffect(()=>{s()},[]);const[a,_]=S.exports.useState(!1),n=()=>_(!a),p=async U=>{await o(se(U)),s(),_(!a)},[N,v]=S.exports.useState(!1),y=()=>v(!N),[C,x]=S.exports.useState(null),[f,m]=S.exports.useState(null);return l(S.exports.Fragment,{children:[l(Z,{children:[e(w,{children:l("h4",{className:"card-title",children:["Batch: ",t==null?void 0:t.batch_number," ",((R=t==null?void 0:t.batch)==null?void 0:R.store)&&"("+((B=(g=t==null?void 0:t.batch)==null?void 0:g.store)==null?void 0:B.store_name)+")"]})}),e(be,{}),e(_e,{handleClose:n,setUploadData:m,setRejectData:x,handleRejectClose:y}),e(me,{batchNote:u,setBatchNote:h,onClick:s})]}),e(ue,{show:a,handleClose:n,uploadData:f,handleUpload:m,FileUpload:p}),e(pe,{isOpen:N,toggle:y,data:C})]})};export{xe as default};
