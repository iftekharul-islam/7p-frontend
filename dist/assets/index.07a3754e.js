import{a as k,r as C,az as D,f as d,aA as X,j as e,aB as ee,aC as re,a0 as S,aD as ne,G as R,aE as de,Q as Z,S as w,T as ce,V as $,aF as le,X as b,Y as c,L as te,aG as ae,aH as oe}from"./index.5183447c.js";import{S as ie}from"./react-select.esm.cd027792.js";import{a as P}from"./App.4b464e6f.js";import{h as se}from"./moment.4d75c86c.js";import"./emotion-memoize.esm.06f0e458.js";const he=({isOpen:r,toggle:p,data:h})=>{const t=P(),{rejectOptions:a}=k(o=>o.batchList),[s,l]=C.exports.useState(null),u=(o,_)=>{l({...s,[o]:_})},i=o=>{u(o.target.name,o.target.value)},n=async()=>{const o=t(de(s));(o==null?void 0:o.payload)==201&&(setRejectShow(!rejectShow),getBatchData())};return C.exports.useEffect(()=>{t(D()),l({id:h==null?void 0:h.id,item_id:h==null?void 0:h.item_id,origin:"BD",title:"Batch view"})},[h]),d(X,{isOpen:r,toggle:p,className:"modal-lg",children:[e(ee,{toggle:p,children:"Reject Information"}),d(re,{children:[e("h5",{children:"Inventory"}),d("div",{className:"btn-group","data-toggle":"buttons",children:[d("label",{className:"btn btn-default btn-lg",style:{width:"280px"},children:[e("span",{className:"glyphicon glyphicon-trash"}),e(S,{type:"radio",name:"scrap",value:"1",onChange:i})," ","Defective Item Produced"]}),d("label",{className:"btn btn-default btn-lg",style:{width:"280px"},children:[e(S,{type:"radio",name:"scrap",value:"0",onChange:i})," ","Nothing Produced"]})]}),e("hr",{}),d("div",{className:"btn-group","data-toggle":"buttons",children:[e("h5",{children:"Graphic"}),d("label",{className:"btn btn-default btn-lg",style:{width:"180px"},children:[e("span",{className:"glyphicon glyphicon-print"}),e(S,{type:"radio",name:"graphic_status",value:"1",onChange:i})," ","Print Again"]}),d("label",{className:"btn btn-default btn-lg",style:{width:"180px"},children:[e("span",{className:"glyphicon glyphicon-pencil"}),e(S,{type:"radio",name:"graphic_status",value:"2",onChange:i})," ","Edit Graphic"]}),d("label",{className:"btn btn-default btn-lg",style:{width:"205px"},children:[e("span",{className:"glyphicon glyphicon-envelope"}),e(S,{type:"radio",name:"graphic_status",value:"4",onChange:i})," ","Contact Customer"]})]}),e("hr",{}),d("div",{className:"form-group",id:"qty_group",children:["Quantity to Reject:"," ",e(S,{type:"number",id:"reject_qty",name:"reject_qty",value:s==null?void 0:s.reject_qty,min:"1",onChange:i})]}),e("div",{className:"form-group",children:e(ie,{className:"select",classNamePrefix:"react-select",name:"rejection_reason",options:a,value:a==null?void 0:a.find(o=>o.value===(s==null?void 0:s.reasonToReject)),onChange:o=>u("rejection_reason",o.value),children:e("option",{value:"",children:"Select a reason to reject"})})}),e("div",{className:"form-group",children:e(S,{type:"textarea",id:"rejection_message",rows:2,className:"form-control",placeholder:"More Information",name:"rejection_message",value:s==null?void 0:s.rejection_message,onChange:i})})]}),d(ne,{children:[e(R,{color:"default",onClick:p,className:"btn-lg modal-close",children:"Close"}),e(R,{color:"danger",onClick:n,className:"btn-lg",children:"Reject"})]})]})},pe=({show:r,handleClose:p,handleUpload:h})=>{const t=a=>{a.preventDefault(),h(a.target.elements.upload_file.files[0]),p()};return e(X,{isOpen:r,toggle:p,className:"modal-lg",children:d(Z,{children:[e(w,{closeButton:!0,children:e(ce,{children:"Upload a Graphic"})}),d($,{children:[e("p",{children:"Upload a graphic to the Archive directory."}),d("form",{name:"track",onSubmit:t,method:"post",encType:"multipart/form-data",children:[e("input",{type:"hidden",name:"item_id",id:"upload_item_id"}),e("input",{type:"hidden",name:"batch_number",id:"upload_batch_number"}),e("input",{type:"file",name:"upload_file",className:"form-control"})]})]}),d(le,{children:[e(R,{className:"success",onClick:t,children:"Upload"}),e(R,{className:"secondary mx-1",onClick:p,children:"Close"})]})]})})},ue=()=>{var p,h,t,a,s,l,u,i,n,o,_,N,v,g,f,y,m,j,x,B,T,E,I,M,U,G,O,q,A,F,Y,Q,z,H,V,J,K,W;const{showData:r}=k(L=>L.batchList);return d($,{children:[d(b,{className:"p-1 pt-0",children:[d(c,{md:"1",children:[e("b",{children:"**Route:"})," "]}),e(c,{md:"9",children:((p=r==null?void 0:r.batch)==null?void 0:p.route)&&e("span",{children:d("span",{children:[(t=(h=r==null?void 0:r.batch)==null?void 0:h.route)==null?void 0:t.batch_code,"/",(s=(a=r==null?void 0:r.batch)==null?void 0:a.route)==null?void 0:s.batch_route_name," => ",r==null?void 0:r.stations]})})}),e(c,{md:"2",children:(u=(l=r==null?void 0:r.batch)==null?void 0:l.route)!=null&&u.template?d("span",{children:[(o=(n=(i=r==null?void 0:r.batch)==null?void 0:i.route)==null?void 0:n.template)==null?void 0:o.template_name," Template"]}):e("span",{children:"No Template"})})]}),d(b,{className:"p-1 pt-0",children:[e(c,{md:"1",children:e("b",{children:"Created:"})}),e(c,{md:"3",children:(_=r==null?void 0:r.batch)==null?void 0:_.creation_date}),e(c,{md:"1",children:e("b",{children:"Last Scan:"})}),e(c,{md:"3",children:(N=r==null?void 0:r.last_scan)!=null&&N.date?((v=r==null?void 0:r.last_scan)==null?void 0:v.date)+" by "+((g=r==null?void 0:r.last_scan)==null?void 0:g.username):(f=r==null?void 0:r.batch)==null?void 0:f.change_date}),e(c,{md:"1",children:e("b",{children:"Station:"})}),e(c,{md:"3",children:(y=r==null?void 0:r.batch)!=null&&y.station?((j=(m=r==null?void 0:r.batch)==null?void 0:m.station)==null?void 0:j.station_name)+" => "+((B=(x=r==null?void 0:r.batch)==null?void 0:x.station)==null?void 0:B.station_description):"Station Not Found"})]}),d(b,{className:"p-1 pt-0",children:[e(c,{md:"1",children:e("b",{children:"Export:"})}),e(c,{md:"3",children:(T=r==null?void 0:r.batch)!=null&&T.export_date?((E=r==null?void 0:r.batch)==null?void 0:E.export_count)==1?d("span",{children:["Exported ",(I=r==null?void 0:r.batch)==null?void 0:I.export_count," time"," ",(M=r==null?void 0:r.batch)==null?void 0:M.export_date]}):d("span",{children:["Exported ",(U=r==null?void 0:r.batch)==null?void 0:U.export_count," times Last export"," ",(G=r==null?void 0:r.batch)==null?void 0:G.export_date]}):"Not Exported"}),e(c,{md:"4",children:((O=r==null?void 0:r.batch)==null?void 0:O.csv_found)!=0&&"CSV File Found"})]}),d(b,{className:"p-1 pt-0",children:[e(c,{md:"1",children:e("b",{children:"Summary:"})}),(q=r==null?void 0:r.batch)!=null&&q.summary_date?e(c,{md:"6",children:d(b,{children:[d(c,{md:"6",children:["Printed ",(A=r==null?void 0:r.batch)==null?void 0:A.summary_date]}),d(c,{md:"6",children:[(F=r==null?void 0:r.batch)==null?void 0:F.summary_count," printed - last by"," ",(Q=(Y=r==null?void 0:r.batch)==null?void 0:Y.summary_user)==null?void 0:Q.username]})]})}):e(c,{md:"6",children:"Not Printed"})]}),d(b,{className:"p-1 pt-0",children:[e(c,{md:"1",children:e("b",{children:"Graphic:"})}),e(c,{md:"3",children:(z=r==null?void 0:r.batch)==null?void 0:z.graphic_found}),((H=r==null?void 0:r.batch)==null?void 0:H.to_printer)!="0"&&e(c,{md:"4",children:d(b,{children:[e(c,{md:"3",children:e("b",{children:"Printed:"})}),d(c,{md:"9",children:[(V=r==null?void 0:r.batch)==null?void 0:V.to_printer," -"," ",(J=r==null?void 0:r.batch)==null?void 0:J.to_printer_date]})]})})]}),((K=r==null?void 0:r.related)==null?void 0:K.length)>0&&d(b,{className:"p-1 pt-0",children:[e(c,{md:"1",children:e("b",{children:"Related:"})}),e(c,{md:"3",children:(W=r==null?void 0:r.related)==null?void 0:W.map(L=>d("span",{children:[L," "]}))})]})]})},be=({batchNote:r,setBatchNote:p,onClick:h})=>{var a,s;const{showData:t}=k(l=>l.batchList);return d($,{children:[d(b,{children:[e(c,{md:"2",className:"p-1 border",children:e("b",{children:"Note"})}),e(c,{md:"1",className:"p-1 border",children:e("b",{children:"Date"})}),e(c,{md:"2",className:"p-1 border",children:e("b",{children:"User"})}),e(c,{md:"1",className:"p-1 border",children:e("b",{children:"Station"})}),e(c,{md:"2",className:"p-1 border",children:e("b",{children:"Station"})}),e(c,{md:"2",className:"p-1 border",children:e("b",{children:"Scan In"})}),e(c,{md:"2",className:"p-1 border",children:e("b",{children:"Scan Out"})})]}),d(b,{children:[e(c,{md:"6",children:(a=t==null?void 0:t.notes)==null?void 0:a.map(l=>{var u,i;return e("span",{children:d(b,{className:"p-1",children:[e(c,{md:"4",children:l==null?void 0:l.note}),e(c,{md:"2",children:se(l==null?void 0:l.created_at).format("DD MM YYYY")}),e(c,{md:"4",children:(u=l==null?void 0:l.user)==null?void 0:u.username}),e(c,{md:"2",children:(i=l==null?void 0:l.station)==null?void 0:i.station_name})]})})})}),e(c,{md:"6",children:(s=t==null?void 0:t.scans)==null?void 0:s.map(l=>{var u,i;return e("span",{children:d(b,{className:"p-1",children:[e(c,{md:"4",children:(u=l==null?void 0:l.station)==null?void 0:u.station_name}),d(c,{md:"4",children:[(i=l==null?void 0:l.in_user)==null?void 0:i.username," ",l==null?void 0:l.in_date]}),e(c,{md:"4",children:(l==null?void 0:l.out_user)&&l.out_user.username+" "+l.out_date})]})})})})]}),d(b,{children:[e(c,{md:"4",children:e(S,{type:"textarea",name:"note",id:"note",placeholder:"Enter Note",value:r,onChange:l=>{p(l.target.value)}})}),e(c,{md:"2",children:e(R,{color:"primary",onClick:h,children:"Add Note"})})]})]})},me=({handleClose:r,setRejectData:p,handleRejectClose:h})=>{var u,i;P();const{showData:t}=k(n=>n.batchList),a=()=>{r()},s=n=>{p(n),h()},l=(n,o=`
`,_=0)=>{let N="",v="";_===1&&(N='<strong style="font-size: 110%;">',v="</strong>");let g="";const f=JSON.parse(n);if(f)for(const y in f){const m=f[y];y!=="Confirmation_of_Order_Details"&&y!=="couponcode"&&(m.includes("$")&&_===1&&(m=`<span style="font-size: 120%;">${m}</span>`),g+=`${y.replaceAll("_"," ")} = ${N}${m}${v}${o}`),console.log(g)}return g};return d($,{children:[d(b,{children:[e(c,{md:"1",className:"p-1 border"}),e(c,{md:"3",className:"p-1 border",children:e("b",{children:"Order"})}),e(c,{md:"2",className:"p-1 border"}),e(c,{md:"3",className:"p-1 border",children:e("b",{children:"Product"})}),e(c,{md:"3",className:"p-1 border",children:e("b",{children:"Options"})})]}),(i=(u=t==null?void 0:t.batch)==null?void 0:u.items)==null?void 0:i.map(n=>{var o,_,N,v,g,f,y,m,j;return d("span",{children:[d(b,{className:"p-1 border",children:[e(c,{md:"1",children:(n==null?void 0:n.item_status)==="production"||(n==null?void 0:n.item_status)==="wap"||(n==null?void 0:n.item_status)==="back order"?d(R,{color:"primary",onClick:()=>s({id:t==null?void 0:t.batch_number,item_id:n==null?void 0:n.id,origin:"BD"}),children:["Reject ",(n==null?void 0:n.item_status)=="wap"?" from Wap":""]}):e("span",{children:n.item_status.charAt(0).toUpperCase()+n.item_status.slice(1)})}),d(c,{md:"3",children:["Order:"," ",e(te,{to:`/customer-order-edit/${(o=n==null?void 0:n.order)==null?void 0:o.id}`,children:(_=n==null?void 0:n.order)==null?void 0:_.short_order}),e("br",{}),"Date : ",(N=n==null?void 0:n.order)==null?void 0:N.order_date,e("br",{}),"Store: ",(g=(v=n==null?void 0:n.order)==null?void 0:v.store)==null?void 0:g.store_name,e("br",{}),"Re Download Graphic: ",n==null?void 0:n.id,e("br",{}),((y=(f=t==null?void 0:t.batch)==null?void 0:f.station)==null?void 0:y.type)=="Q"&&d(R,{color:"primary",onClick:a,children:["Upload ",n==null?void 0:n.id," Graphic"]})]}),e(c,{md:"2"}),d(c,{md:"3",children:[n==null?void 0:n.child_sku,e("br",{}),n==null?void 0:n.item_description,e("br",{}),"Item# ",n==null?void 0:n.id,e("br",{}),(n==null?void 0:n.item_quantity)===1?d("span",{children:["QTY: ",n==null?void 0:n.item_quantity]}):d("strong",{children:["QTY: ",n==null?void 0:n.item_quantity]}),e("br",{}),n.spec_sheet&&d("div",{children:[e("a",{href:`/products_specifications/${n.spec_sheet.id}`,target:"_blank",children:"Production Instruction"}),e("br",{})]}),n.supervisor_message&&d("div",{children:[n.supervisor_message,e("br",{})]}),n.tracking_number&&d("div",{style:{color:"red"},children:["TRK# ",n.tracking_number]})]}),e(c,{md:"3",children:e(S,{type:"textarea",Rows:"5",value:l(n==null?void 0:n.item_option),disabled:!0})})]}),((m=n==null?void 0:n.rejections)==null?void 0:m.length)&&((j=n==null?void 0:n.rejections)==null?void 0:j.map(x=>d(b,{className:"p-1 border",children:[e(c,{md:2}),d(c,{md:8,children:["Item ",n.id," Rejected ",x.created_at," by"," ",x.user.username,x.rejection_reason_info&&` - ${x.rejection_reason_info.rejection_message}`,"- ",x.rejection_message]})]})))]})})]})},xe=()=>{var m,j,x;const{id:r}=ae(),[p,h]=C.exports.useState(null),t=P(),{showData:a}=k(B=>B.batchList),[s,l]=C.exports.useState(!1),u=async()=>{l(!0),r&&await t(oe({id:r,batchNote:p})),h(""),l(!1)};C.exports.useEffect(()=>{u()},[]);const[i,n]=C.exports.useState(!1),o=()=>n(!i),_=()=>{n(!i)},[N,v]=C.exports.useState(!1),g=()=>v(!N),[f,y]=C.exports.useState(null);return d(C.exports.Fragment,{children:[d(Z,{children:[e(w,{children:d("h4",{className:"card-title",children:["Batch: ",a==null?void 0:a.batch_number," ",((m=a==null?void 0:a.batch)==null?void 0:m.store)&&"("+((x=(j=a==null?void 0:a.batch)==null?void 0:j.store)==null?void 0:x.store_name)+")"]})}),e(ue,{}),e(me,{handleClose:o,setRejectData:y,handleRejectClose:g}),e(be,{batchNote:p,setBatchNote:h,onClick:u})]}),e(pe,{show:i,handleClose:o,handleUpload:_}),e(he,{isOpen:N,toggle:g,data:f})]})};export{xe as default};
